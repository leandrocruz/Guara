<polymer-element name="g-file" attributes="title class accept">
	<template>
		<link rel="stylesheet" href="g-file.css">
		<a id="button" on-click="{{ triggerFileSelect }}" class="btn btn-default {{class}}" style="width: 100%">
			{{title}}
		</a>		
		<input id="file" on-change="{{ onFileSelected }} " type="file" class="hidden" title="{{title}}" accept="{{accept}}">
	</template>
	<script>
    	Polymer('g-file', {

    		getInput: function() {
    			return $(this.$.file);
    		},

    		getFile: function() {
    			var input = this.getInput();
    			return input.prop('files')[0];
    		},
    		
    		readFile: function(whenReady) {
    			var file   = this.getFile();
    			var reader = new FileReader();
    			reader.onloadend = function(e) {
    				var base64  = btoa(e.target.result);
    				var encoded = encodeURIComponent(base64);
    				whenReady(file, encoded);
				};
    			reader.readAsBinaryString(file);
    		},
    		
    		getFileName: function(name) {
    			var idx = name.lastIndexOf('\\');
    			return name.substring(idx + 1, name.length);	
    		},

    		/* 
    		 * Events 
    		*/
    		triggerFileSelect: function() {
    			this.getInput().trigger('click');
    		},
    		
    		onFileSelected: function() {
    			var file  = this.getFile();
    			var size  = new Number(file.size/1024).toFixed(2);
    			var label = file.name + " - " + size + " KB";
    			$(this.$.button).text(label);

    			this.fire('file-selected', {file: file});
    		}
    	});
	</script>
</polymer-element>
