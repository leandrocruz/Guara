<polymer-element name="g-file" attributes="title class accept isDirectory">
	<template>
		<link rel="stylesheet" href="g-file.css">
		<a id="button" on-click="{{ triggerFileSelect }}" class="btn btn-default {{class}}" style="width: 100%">
			{{title}}
		</a>
		<template if="{{ isDirectory }}">
			<input 	id="file"
					type="file"
					class="hidden"
					on-change="{{ onFileSelected }}" title="{{title}}" accept="{{accept}}" 
					webkitdirectory directory />
		</template>
		<template if="{{ !isDirectory }}">
			<input 	id="file"
					type="file"
					class="hidden"
					on-change="{{ onFileSelected }}" title="{{title}}" accept="{{accept}}" />
		</template>

		
	</template>
	<script>
    	Polymer('g-file', {

    		isDirectory: false,
    		
    		getInput: function() {
    			return $(this.$.file);
    		},

    		getFile: function() {
    			var input = this.getInput();
    			return input.prop('files')[0];
    		},
    		
    		readFile: function(whenReady) {
    			var file   = this.getFile();
    			var reader = new FileReader();
    			reader.onloadend = function(e) {
    				var base64  = btoa(e.target.result);
    				var encoded = encodeURIComponent(base64);
    				whenReady(file, encoded);
				};
    			reader.readAsBinaryString(file);
    		},
    		
    		getFileName: function(name) {
    			var idx = name.lastIndexOf('\\');
    			return name.substring(idx + 1, name.length);	
    		},

    		/* 
    		 * Events 
    		*/
    		triggerFileSelect: function() {
    			this.getInput().trigger('click');
    		},
    		
    		onFileSelected: function() {
    			
				var label = this.title;
				var file  = this.getFile();
				if(file)
				{
					var size = new Number(file.size / 1024).toFixed(2);
					label = file.name + " - " + size + " KB";
				}

				$(this.$.button).text(label);
				this.fire('file-selected', {file : file});
			}
		});
	</script>
</polymer-element>
